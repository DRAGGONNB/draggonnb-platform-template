[
  {
    "id": "ERR-001",
    "timestamp": "2026-02-08",
    "session": 21,
    "category": "runtime",
    "source": "supabase",
    "error_message": "column \"posts_monthly\" does not exist / column \"ai_generations_monthly\" does not exist",
    "root_cause": "Code referenced posts_monthly and ai_generations_monthly but actual DB columns are posts_published and ai_generations_count in client_usage_metrics table",
    "resolution": "Updated all queries to use correct column names: posts_published, ai_generations_count",
    "prevention": "Always check actual table schema before writing queries. Refer to DB Column Names section in MEMORY.md",
    "files_affected": ["lib/tier/feature-gate.ts", "app/api/usage/route.ts"],
    "recurring": true,
    "tags": ["column-name", "schema-mismatch", "client_usage_metrics"]
  },
  {
    "id": "ERR-002",
    "timestamp": "2026-02-08",
    "session": 22,
    "category": "runtime",
    "source": "supabase",
    "error_message": "column \"status\" does not exist on deals table",
    "root_cause": "Code used 'status' but deals table uses 'stage' column with values: prospect, qualified, proposal, won, lost",
    "resolution": "Updated queries to reference 'stage' instead of 'status'",
    "prevention": "Deals table uses 'stage' not 'status'. Check schema before querying",
    "files_affected": ["app/api/deals/route.ts"],
    "recurring": true,
    "tags": ["column-name", "schema-mismatch", "deals"]
  },
  {
    "id": "ERR-003",
    "timestamp": "2026-02-09",
    "session": 22,
    "category": "migration",
    "source": "supabase",
    "error_message": "relation \"companies\" does not exist / relation \"platform_metrics\" does not exist",
    "root_cause": "Dashboard code referenced companies and platform_metrics tables that had not been created in the database",
    "resolution": "Created migration to add the missing tables",
    "prevention": "Verify all referenced tables exist before writing code that queries them",
    "files_affected": ["app/(dashboard)/dashboard/page.tsx"],
    "recurring": false,
    "tags": ["missing-table", "schema-mismatch", "migration"]
  },
  {
    "id": "ERR-004",
    "timestamp": "2026-02-09",
    "session": 22,
    "category": "migration",
    "source": "supabase",
    "error_message": "Security advisor: function does not have search_path set",
    "root_cause": "5 Supabase functions were missing SET search_path = public, flagged by security advisor",
    "resolution": "Added SET search_path = public to all 5 functions: capture_lead, provision_client, get_media_stats, increment_media_usage, update_media_updated_at",
    "prevention": "Always include SET search_path = public when creating or altering Supabase functions",
    "files_affected": ["supabase/migrations/05_security_hardening.sql"],
    "recurring": true,
    "tags": ["search_path", "security", "functions"]
  },
  {
    "id": "ERR-005",
    "timestamp": "2026-02-09",
    "session": 22,
    "category": "migration",
    "source": "supabase",
    "error_message": "Security advisor: view uses SECURITY DEFINER, bypassing RLS",
    "root_cause": "3 views (dbe_lead_pipeline, dbe_client_overview, dbe_dashboard_metrics) used SECURITY DEFINER instead of SECURITY INVOKER, bypassing row-level security",
    "resolution": "Recreated views with SECURITY INVOKER",
    "prevention": "Always use SECURITY INVOKER for views unless there is a specific reason to bypass RLS",
    "files_affected": ["supabase/migrations/05_security_hardening.sql"],
    "recurring": false,
    "tags": ["security", "views", "rls", "security-definer"]
  },
  {
    "id": "ERR-006",
    "timestamp": "2026-01-20",
    "session": 10,
    "category": "build",
    "source": "nextjs",
    "error_message": "useSearchParams() should be wrapped in a suspense boundary at page \"/path\". Read more: https://nextjs.org/docs/messages/missing-suspense-with-csr-bailout",
    "root_cause": "Next.js 14 requires useSearchParams() to be wrapped in a Suspense boundary for static site generation (SSG) compatibility",
    "resolution": "Wrapped components using useSearchParams() in <Suspense> boundary",
    "prevention": "Always wrap useSearchParams() calls in a Suspense boundary in Next.js 14",
    "files_affected": [],
    "recurring": true,
    "tags": ["suspense", "useSearchParams", "ssg", "build-error"]
  },
  {
    "id": "ERR-007",
    "timestamp": "2026-01-25",
    "session": 15,
    "category": "build",
    "source": "vercel",
    "error_message": "Type 'X' is not assignable to type 'Y' (various type assertion failures on Vercel build)",
    "root_cause": "Vercel TypeScript compilation is stricter than local. Type assertions that pass locally fail on Vercel",
    "resolution": "Cast complex types through unknown first: value as unknown as TargetType",
    "prevention": "For complex type assertions, always cast through unknown. Run tsc --noEmit locally before pushing",
    "files_affected": [],
    "recurring": true,
    "tags": ["typescript", "type-assertion", "vercel-build", "strictness"]
  },
  {
    "id": "ERR-008",
    "timestamp": "2026-01-25",
    "session": 15,
    "category": "runtime",
    "source": "typescript",
    "error_message": "Property 'replyTo' does not exist on type / email sent without reply-to header",
    "root_cause": "Resend email SDK uses snake_case property names (reply_to) not camelCase (replyTo)",
    "resolution": "Changed replyTo to reply_to in Resend API calls",
    "prevention": "Resend SDK uses snake_case. Check SDK docs for correct property names",
    "files_affected": ["lib/email/resend.ts"],
    "recurring": false,
    "tags": ["resend", "snake_case", "api-mismatch"]
  },
  {
    "id": "ERR-009",
    "timestamp": "2026-02-01",
    "session": 18,
    "category": "runtime",
    "source": "supabase",
    "error_message": "Supabase MCP authentication failed / token expired",
    "root_cause": "Supabase MCP uses OAuth with browser login. Tokens expire frequently and need re-authentication each session",
    "resolution": "Re-authenticate via browser login when token expires",
    "prevention": "Expect re-auth at the start of each session. Do not cache tokens long-term",
    "files_affected": [],
    "recurring": true,
    "tags": ["supabase-mcp", "oauth", "token-expiry", "auth"]
  },
  {
    "id": "ERR-010",
    "timestamp": "2026-02-05",
    "session": 20,
    "category": "deployment",
    "source": "github",
    "error_message": "Could not resolve host: git.draggonnb.online / DNS resolution failed",
    "root_cause": "Gitea domain git.draggonnb.online does not resolve from Windows dev machine due to DNS configuration",
    "resolution": "Use SSH tunnel to VPS and access Gitea via localhost:3030 instead of the domain",
    "prevention": "Always use SSH + localhost:3030 for Gitea API calls from Windows. Never rely on DNS resolution of git.draggonnb.online",
    "files_affected": [],
    "recurring": true,
    "tags": ["gitea", "dns", "windows", "ssh-tunnel"]
  },
  {
    "id": "ERR-011",
    "timestamp": "2026-02-05",
    "session": 20,
    "category": "deployment",
    "source": "github",
    "error_message": "Connection refused on port 3000 / curl: (7) Failed to connect to localhost port 3000",
    "root_cause": "Gitea container maps internal port 3000 to host port 3030. Using port 3000 on the host fails",
    "resolution": "Changed all Gitea API calls to use port 3030 on the VPS host",
    "prevention": "Gitea on VPS: always use port 3030 (host), not 3000 (container internal)",
    "files_affected": [],
    "recurring": false,
    "tags": ["gitea", "port-mapping", "docker", "connection-refused"]
  }
]
