---
phase: 04-n8n-automation
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - app/(dashboard)/dashboard/page.tsx
  - components/dashboard/AnalyticsCard.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard displays analytics data from analytics_snapshots table"
    - "Analytics show total posts published in last 24 hours"
    - "Analytics show platforms used"
    - "Empty state displays when no analytics data exists"
  artifacts:
    - path: "components/dashboard/AnalyticsCard.tsx"
      provides: "Analytics display component"
      min_lines: 30
    - path: "app/(dashboard)/dashboard/page.tsx"
      provides: "Dashboard with analytics integration"
      contains: "analytics_snapshots"
  key_links:
    - from: "app/(dashboard)/dashboard/page.tsx"
      to: "supabase.analytics_snapshots"
      via: "Supabase query"
      pattern: "from\\(['\"]analytics_snapshots['\"]\\)"
---

<objective>
Display analytics data collected by the N8N Analytics Collector workflow on the dashboard.

Purpose: The Analytics Collector workflow runs daily at 6 AM SAST and saves snapshots to the analytics_snapshots table. The dashboard should display this data so users can see their content publishing activity.

Output: Dashboard shows real analytics data from N8N-collected snapshots with proper empty states.
</objective>

<execution_context>
@C:\Users\Chris Terblanche\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris Terblanche\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-n8n-automation/04-RESEARCH.md
@.planning/phases/04-n8n-automation/04-01-SUMMARY.md

@app/(dashboard)/dashboard/page.tsx
@components/dashboard/EmptyState.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnalyticsCard component</name>
  <files>components/dashboard/AnalyticsCard.tsx</files>
  <action>
Create a reusable AnalyticsCard component that displays analytics data.

```typescript
// components/dashboard/AnalyticsCard.tsx
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { BarChart3, TrendingUp, Calendar } from 'lucide-react'
import { EmptyState } from './EmptyState'

interface AnalyticsSnapshot {
  id: string
  snapshot_date: string
  total_posts_24h: number
  platforms_used: string[]
  collected_at: string
}

interface AnalyticsCardProps {
  snapshots: AnalyticsSnapshot[]
  className?: string
}

export function AnalyticsCard({ snapshots, className }: AnalyticsCardProps) {
  if (!snapshots || snapshots.length === 0) {
    return (
      <Card className={className}>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <BarChart3 className="h-5 w-5" />
            Content Analytics
          </CardTitle>
          <CardDescription>Daily publishing activity</CardDescription>
        </CardHeader>
        <CardContent>
          <EmptyState
            icon={BarChart3}
            title="No analytics yet"
            description="Analytics will appear after your first content is published. The collector runs daily at 6 AM."
          />
        </CardContent>
      </Card>
    )
  }

  // Get most recent snapshot
  const latest = snapshots[0]

  // Calculate week total (sum of last 7 days)
  const weekTotal = snapshots
    .slice(0, 7)
    .reduce((sum, s) => sum + (s.total_posts_24h || 0), 0)

  // Get unique platforms from recent snapshots
  const allPlatforms = [...new Set(snapshots.flatMap(s => s.platforms_used || []))]

  return (
    <Card className={className}>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <BarChart3 className="h-5 w-5" />
          Content Analytics
        </CardTitle>
        <CardDescription>
          Last updated: {new Date(latest.collected_at).toLocaleDateString('en-ZA')}
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-1">
            <p className="text-sm text-muted-foreground">Posts (24h)</p>
            <p className="text-2xl font-bold">{latest.total_posts_24h}</p>
          </div>
          <div className="space-y-1">
            <p className="text-sm text-muted-foreground">Posts (7 days)</p>
            <p className="text-2xl font-bold">{weekTotal}</p>
          </div>
        </div>

        {allPlatforms.length > 0 && (
          <div className="space-y-2">
            <p className="text-sm text-muted-foreground">Active Platforms</p>
            <div className="flex flex-wrap gap-2">
              {allPlatforms.map(platform => (
                <span
                  key={platform}
                  className="px-2 py-1 bg-primary/10 text-primary rounded-full text-xs capitalize"
                >
                  {platform}
                </span>
              ))}
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

The component:
1. Shows empty state when no snapshots exist
2. Displays 24h post count from latest snapshot
3. Calculates 7-day total from available snapshots
4. Shows active platforms as badges
5. Uses South African date locale (en-ZA)
  </action>
  <verify>
test -f components/dashboard/AnalyticsCard.tsx
npm run build
  </verify>
  <done>
AnalyticsCard component created with empty state handling and proper data display.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate analytics into dashboard</name>
  <files>app/(dashboard)/dashboard/page.tsx</files>
  <action>
Update the dashboard page to fetch and display analytics data.

1. Add analytics_snapshots to the parallel query pattern already in the dashboard:

```typescript
// In the Promise.all block, add:
const analyticsPromise = supabase
  .from('analytics_snapshots')
  .select('*')
  .order('snapshot_date', { ascending: false })
  .limit(7)
```

2. Import and render the AnalyticsCard component:

```typescript
import { AnalyticsCard } from '@/components/dashboard/AnalyticsCard'

// In the return JSX, add the AnalyticsCard in an appropriate grid position:
<AnalyticsCard snapshots={analyticsData || []} className="col-span-full lg:col-span-1" />
```

3. The dashboard already uses Promise.all for parallel queries (as established in Phase 2). Add the analytics query to this pattern.

4. Position the AnalyticsCard in the dashboard grid layout - suggest placing it in the stats row or as a sidebar card.

Note: analytics_snapshots table may be empty if the collector hasn't run yet. The AnalyticsCard handles this with an empty state.
  </action>
  <verify>
grep "analytics_snapshots" app/(dashboard)/dashboard/page.tsx
grep "AnalyticsCard" app/(dashboard)/dashboard/page.tsx
npm run build
  </verify>
  <done>
Dashboard fetches analytics_snapshots and displays AnalyticsCard with real data or empty state.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify analytics display with test data</name>
  <files>(no files modified - verification only)</files>
  <action>
Test the analytics display by:

1. Start dev server: `npm run dev`
2. Login and go to dashboard
3. Verify:
   - If analytics_snapshots is empty: Empty state message appears ("No analytics yet...")
   - AnalyticsCard renders without errors

4. Optionally insert test data to verify data display:

Using Supabase SQL Editor or the Supabase client, insert a test snapshot:
```sql
INSERT INTO analytics_snapshots (snapshot_date, total_posts_24h, platforms_used, collected_at)
VALUES
  ('2026-02-05', 5, ARRAY['linkedin', 'facebook'], NOW()),
  ('2026-02-04', 3, ARRAY['linkedin'], NOW() - INTERVAL '1 day');
```

5. Refresh dashboard and verify:
   - Posts (24h) shows: 5
   - Posts (7 days) shows: 8
   - Active Platforms shows: linkedin, facebook badges

6. Clean up test data after verification (optional):
```sql
DELETE FROM analytics_snapshots WHERE snapshot_date IN ('2026-02-05', '2026-02-04');
```

Document any layout or styling issues found and address them.
  </action>
  <verify>
Dev server runs without errors.
Dashboard page loads without console errors.
AnalyticsCard renders (either with data or empty state).
  </verify>
  <done>
Analytics display works correctly on dashboard. Empty state and data state both verified.
  </done>
</task>

</tasks>

<verification>
1. AnalyticsCard component exists and exports correctly
2. Dashboard imports and renders AnalyticsCard
3. Dashboard fetches from analytics_snapshots table
4. Empty state displays when no data exists
5. Data displays correctly when snapshots exist
6. npm run build passes
</verification>

<success_criteria>
- Dashboard shows analytics section with real data from N8N collector
- Empty state appears when no analytics data exists
- 24h and 7-day totals calculate correctly
- Platform badges display correctly
- No console errors during dashboard load
</success_criteria>

<output>
After completion, create `.planning/phases/04-n8n-automation/04-03-SUMMARY.md`
</output>
