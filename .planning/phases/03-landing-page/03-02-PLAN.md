---
phase: 03-landing-page
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/payments/payfast.ts
  - app/payment/success/page.tsx
autonomous: true

must_haves:
  truths:
    - "Payment success page displays the specific tier name the user subscribed to"
    - "User sees a visual progress indicator showing they completed step 1 of the onboarding process"
    - "Timeline expectations are clear (provisioning time, welcome email, onboarding call)"
    - "Page is fully responsive on mobile devices"
  artifacts:
    - path: "app/payment/success/page.tsx"
      provides: "Enhanced payment success page with tier display and progress indicator"
      min_lines: 80
    - path: "lib/payments/payfast.ts"
      provides: "Return URL includes tier query parameter"
      contains: "tier="
  key_links:
    - from: "lib/payments/payfast.ts"
      to: "app/payment/success/page.tsx"
      via: "return_url query parameter"
      pattern: "tier=.*planTier"
    - from: "app/payment/success/page.tsx"
      to: "lib/payments/payfast.ts"
      via: "PRICING_TIERS import"
      pattern: "import.*PRICING_TIERS"
---

<objective>
Enhance the payment success page to show the specific tier the user subscribed to, add a visual progress indicator, clarify the provisioning timeline, and ensure mobile responsiveness.

Purpose: Complete Phase 3 requirements by improving the post-payment experience so users know exactly what they paid for and what happens next.
Output: Updated payment success page that dynamically displays tier information and provides clear onboarding expectations.
</objective>

<execution_context>
@C:\Users\Chris Terblanche\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris Terblanche\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/payments/payfast.ts
@app/payment/success/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tier query param to PayFast return URL</name>
  <files>lib/payments/payfast.ts</files>
  <action>
Modify the `createPayFastSubscription` function to include the tier as a query parameter in the return URL.

In the `formData` object (around line 226), update the `return_url` line:

From:
```typescript
return_url: process.env.PAYFAST_RETURN_URL || `${process.env.NEXT_PUBLIC_APP_URL}/payment/success`,
```

To:
```typescript
return_url: `${process.env.PAYFAST_RETURN_URL || `${process.env.NEXT_PUBLIC_APP_URL}/payment/success`}?tier=${encodeURIComponent(request.metadata?.planTier || '')}`,
```

This ensures the tier name is passed to the success page via URL parameter after PayFast redirects back.
  </action>
  <verify>
Run `npm run build` to ensure no TypeScript errors. The return_url should now include `?tier=` query parameter.
  </verify>
  <done>
PayFast return URL includes tier query parameter that will be available on the success page.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance payment success page with tier display and progress indicator</name>
  <files>app/payment/success/page.tsx</files>
  <action>
Rewrite the payment success page to:

1. **Read tier from URL params:** Use Next.js `searchParams` prop to get the tier name
2. **Import PRICING_TIERS:** Get tier details (name, price, features) from `lib/payments/payfast`
3. **Display tier information:** Show the tier name and price the user subscribed to
4. **Add progress indicator:** Visual 3-step indicator showing:
   - Step 1: Payment Complete (green, checked)
   - Step 2: Account Provisioning (orange, in progress)
   - Step 3: Ready to Use (gray, pending)
5. **Clarify timeline:** Update the "What happens next?" section with more specific timing
6. **Mobile responsive:** Ensure proper spacing and tap targets on mobile

Implementation details:
- Convert to async server component to access searchParams
- Use `searchParams.tier` to look up tier from PRICING_TIERS
- Fallback gracefully if tier param is missing (show generic message)
- Progress indicator: horizontal on desktop, vertical on mobile
- Use existing lucide-react icons: CheckCircle, Clock, Rocket
- Keep existing dark theme gradient styling
- Maintain existing CTA buttons (Dashboard, Home)
- Keep support contact link

Structure:
```tsx
export default async function PaymentSuccessPage({
  searchParams,
}: {
  searchParams: Promise<{ tier?: string }>
}) {
  const params = await searchParams
  const tierKey = params.tier
  const tier = tierKey ? PRICING_TIERS[tierKey] : null

  // ... render with tier info
}
```
  </action>
  <verify>
1. Run `npm run build` - should compile without errors
2. Run `npm run dev` and visit `/payment/success?tier=starter` - should show "Starter" tier and R1,500/month
3. Visit `/payment/success?tier=professional` - should show "Professional" tier and R3,500/month
4. Visit `/payment/success` (no tier param) - should show generic success message
5. Check mobile view in browser dev tools - progress indicator should stack vertically
  </verify>
  <done>
Payment success page displays tier name and price, shows 3-step progress indicator, has clearer timeline, and is mobile responsive.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Build check:** `npm run build` passes with no errors
2. **Tier display test:** Visit `/payment/success?tier=enterprise` and confirm:
   - Page shows "Enterprise" tier name
   - Page shows "R7,500/month" price
   - Progress indicator shows step 1 complete, step 2 in progress
3. **Fallback test:** Visit `/payment/success` (no params) and confirm generic success message displays
4. **Mobile test:** Use browser dev tools responsive mode to verify:
   - Progress indicator is usable on 375px width
   - All text is readable
   - CTAs are tappable (min 44px height)
5. **Integration check:** The PayFast flow will now redirect to `/payment/success?tier=starter` (or professional/enterprise) after payment
</verification>

<success_criteria>
- Payment success page shows the specific tier name (Starter/Professional/Enterprise)
- Payment success page shows the tier price (R1,500/R3,500/R7,500)
- Visual progress indicator shows 3 steps with step 1 complete
- Timeline section provides clear expectations (5-10 min provisioning, welcome email, onboarding call)
- Page renders correctly on mobile (375px and up)
- Graceful fallback when tier param is missing
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-landing-page/03-02-SUMMARY.md`
</output>
