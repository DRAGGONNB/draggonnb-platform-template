---
phase: 02-core-module-completion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(dashboard)/dashboard/page.tsx
  - components/dashboard/EmptyState.tsx
  - components/dashboard/ActivityFeed.tsx
  - components/dashboard/TopPerformingPosts.tsx
  - components/dashboard/StatCard.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard loads with real contact counts, deal values, and email stats from Supabase"
    - "Zero hardcoded fake data visible (no '87 posts', no 'Sarah', no 'Mike')"
    - "Empty-state messages appear when organization has no data"
    - "Dashboard queries run in parallel (Promise.all)"
  artifacts:
    - path: "app/(dashboard)/dashboard/page.tsx"
      provides: "Dashboard page with parallel queries and empty state handling"
      contains: "Promise.all"
    - path: "components/dashboard/EmptyState.tsx"
      provides: "Reusable empty state component"
      exports: ["EmptyState"]
    - path: "components/dashboard/ActivityFeed.tsx"
      provides: "Activity feed without fake users"
      contains: "No activity yet"
    - path: "components/dashboard/TopPerformingPosts.tsx"
      provides: "Posts component with empty state"
      contains: "No posts yet"
  key_links:
    - from: "app/(dashboard)/dashboard/page.tsx"
      to: "supabase.from('contacts')"
      via: "parallel query with count"
      pattern: "count.*exact.*head.*true"
    - from: "app/(dashboard)/dashboard/page.tsx"
      to: "components/dashboard/EmptyState.tsx"
      via: "conditional rendering on empty data"
      pattern: "length === 0"
---

<objective>
Replace hardcoded dashboard values with real Supabase data and add empty state handling.

Purpose: The dashboard currently shows fake data (87 posts, "Sarah posted to LinkedIn") which confuses users and doesn't reflect their actual usage. This plan wires the dashboard to real data and shows helpful empty states for new users.

Output: Dashboard page with parallel Supabase queries, reusable EmptyState component, and updated ActivityFeed/TopPerformingPosts with empty state handling.
</objective>

<execution_context>
@C:\Users\Chris Terblanche\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris Terblanche\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-module-completion/02-RESEARCH.md

# Relevant source files
@app/(dashboard)/dashboard/page.tsx
@components/dashboard/ActivityFeed.tsx
@components/dashboard/TopPerformingPosts.tsx
@components/dashboard/StatCard.tsx
@lib/auth/get-user-org.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reusable EmptyState component</name>
  <files>components/dashboard/EmptyState.tsx</files>
  <action>
Create a new EmptyState component with the following:

1. Props interface:
   - icon?: LucideIcon (default: FileQuestion)
   - title: string
   - description: string
   - action?: { label: string; href: string }

2. Implementation:
   - Centered flex container with py-12 padding
   - Icon in gray-400 with rounded-full gray-100 background
   - Title in text-lg font-semibold text-gray-900
   - Description in text-sm text-gray-600 with max-w-sm
   - Optional CTA button styled as blue-600 rounded-lg

3. Use lucide-react for icons (already installed)
4. Use Tailwind classes matching existing dashboard styling
5. Export as named export: `export function EmptyState`

Reference pattern from research:
```typescript
import { FileQuestion, LucideIcon } from 'lucide-react'

interface EmptyStateProps {
  icon?: LucideIcon
  title: string
  description: string
  action?: { label: string; href: string }
}
```
  </action>
  <verify>File exists at components/dashboard/EmptyState.tsx and exports EmptyState function</verify>
  <done>EmptyState component created with icon, title, description, and optional CTA props</done>
</task>

<task type="auto">
  <name>Task 2: Update dashboard page with parallel queries and empty states</name>
  <files>app/(dashboard)/dashboard/page.tsx</files>
  <action>
Refactor getDashboardData function to use parallel queries:

1. **Remove hardcoded fallback values:**
   - Line 66: Change `data.usage?.posts_monthly || 87` to `data.usage?.posts_monthly || 0`
   - Line 67: Change `data.usage?.engagement_rate || 4.8` to `data.usage?.engagement_rate || 0`
   - Line 68: Change `data.recentPosts?.length || 34` to `data.contactsCount || 0` (fix - this should be contacts count)
   - Line 69: Change `'R12.5k'` to calculate from real deals data

2. **Add contacts count query:**
   Add a query to count contacts:
   ```typescript
   const contactsQuery = supabase
     .from('contacts')
     .select('id', { count: 'exact', head: true })
     .eq('organization_id', organizationId)
   ```

3. **Add deals revenue query:**
   Add a query to sum closed-won deals:
   ```typescript
   const dealsQuery = supabase
     .from('deals')
     .select('value')
     .eq('organization_id', organizationId)
     .eq('status', 'closed_won')
   ```

4. **Convert to parallel fetching:**
   Instead of sequential awaits, use Promise.all:
   ```typescript
   const [
     { data: usageData },
     { count: contactsCount },
     { data: deals },
     { data: recentPosts },
     { data: analyticsData },
     { data: topPosts },
   ] = await Promise.all([
     usageQuery,
     contactsQuery,
     dealsQuery,
     postsQuery,
     analyticsQuery,
     topPostsQuery,
   ])
   ```

5. **Calculate real values:**
   - postsCount = usageData?.posts_monthly || 0
   - engagementRate = usageData?.engagement_rate || 0
   - contactsCount = from count query || 0
   - totalRevenue = deals?.reduce((sum, d) => sum + (d.value || 0), 0) || 0

6. **Update StatCard values:**
   - Posts: show postsCount, if 0 show empty hint
   - Engagement: show engagementRate%, if 0 show empty hint
   - Contacts: show contactsCount
   - Revenue: show `R${(totalRevenue / 1000).toFixed(1)}k` or "R0" if zero

7. **Add empty state for chart:**
   Before RealtimeEngagementChart, check if chartData.length === 0 and show EmptyState with:
   - title: "No analytics yet"
   - description: "Analytics will appear here once you start publishing content."

8. **Import EmptyState:**
   Add: `import { EmptyState } from '@/components/dashboard/EmptyState'`

IMPORTANT: Keep all existing imports and component structure. Only modify the data fetching and values.
  </action>
  <verify>npm run build passes without errors; grep for "|| 87" and "|| 4.8" returns no matches in dashboard page</verify>
  <done>Dashboard uses Promise.all for parallel queries, shows 0 instead of hardcoded values, has empty state for chart</done>
</task>

<task type="auto">
  <name>Task 3: Update ActivityFeed and TopPerformingPosts with empty states</name>
  <files>
    components/dashboard/ActivityFeed.tsx
    components/dashboard/TopPerformingPosts.tsx
  </files>
  <action>
**ActivityFeed.tsx:**
1. Remove the defaultActivities array entirely (lines 13-35 with Sarah, Mike, Alex)
2. Change prop default from `activities = defaultActivities` to `activities = []`
3. Add empty state check at start of component:
   ```typescript
   if (activities.length === 0) {
     return (
       <div className="flex flex-col items-center justify-center py-8 text-center">
         <Users className="h-8 w-8 text-gray-300 mb-2" />
         <p className="text-sm font-medium text-gray-500">No activity yet</p>
         <p className="text-xs text-gray-400">Team actions will appear here</p>
       </div>
     )
   }
   ```
4. Import Users icon: `import { Users } from 'lucide-react'`

**TopPerformingPosts.tsx:**
1. Read current file structure first
2. If props have posts array, add empty state check:
   ```typescript
   if (!posts || posts.length === 0) {
     return (
       <div className="rounded-2xl border bg-white p-6">
         <h3 className="mb-4 text-base font-semibold">Top Performing Posts</h3>
         <div className="flex flex-col items-center justify-center py-8 text-center">
           <TrendingUp className="h-8 w-8 text-gray-300 mb-2" />
           <p className="text-sm font-medium text-gray-500">No posts yet</p>
           <p className="text-xs text-gray-400 mb-4">Create your first post to see performance</p>
           <a
             href="/content-generator"
             className="text-sm font-medium text-blue-600 hover:text-blue-700"
           >
             Create Post
           </a>
         </div>
       </div>
     )
   }
   ```
3. Import TrendingUp icon: `import { TrendingUp } from 'lucide-react'`

Both files: Ensure no hardcoded fake data remains. Use existing Tailwind classes for consistency.
  </action>
  <verify>grep for "Sarah" and "Mike" in components/dashboard/ returns no matches; npm run build passes</verify>
  <done>ActivityFeed shows "No activity yet" when empty; TopPerformingPosts shows empty state with CTA</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build verification:**
   ```bash
   npm run build
   ```
   Must pass with no errors.

2. **No hardcoded data verification:**
   ```bash
   grep -r "87\|Sarah\|Mike\|Alex\|4\.8\|12\.5k" app/\(dashboard\)/dashboard/ components/dashboard/
   ```
   Should return no matches for dashboard-related fake data.

3. **Parallel query verification:**
   ```bash
   grep "Promise.all" app/\(dashboard\)/dashboard/page.tsx
   ```
   Should return a match.

4. **Empty state component exists:**
   ```bash
   test -f components/dashboard/EmptyState.tsx && echo "EmptyState exists"
   ```
</verification>

<success_criteria>
- Dashboard page fetches data using Promise.all (parallel queries)
- No hardcoded fallback values like 87, 4.8, R12.5k remain
- EmptyState component created and exported
- ActivityFeed shows "No activity yet" when activities array is empty
- TopPerformingPosts shows empty state with CTA when posts array is empty
- npm run build passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-module-completion/02-01-SUMMARY.md`
</output>
